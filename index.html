<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Einsatzplan Kindergarten</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f2f2f2;
        }
        h2 {
            margin-top: 30px;
        }
        input, button, select {
            margin: 5px;
            padding: 8px;
        }
        table {
            border-collapse: collapse;
            margin-top: 10px;
            width: 100%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: left;
        }
        #adminSection {
            display: none;
            background: #fff8dc;
            padding: 20px;
            margin-top: 20px;
        }
        #einsatzTabelle {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<h1>Arbeitseinsätze - Waldorfkindergarten</h1>

<div id="einsatzTabelle">
    <h2>Verfügbare Einsätze</h2>
    <table id="einsatzListe"></table>
</div>

<h2>Als Helfer eintragen</h2>
<label for="helferName">Name:</label>
<input type="text" id="helferName">
<label for="einsatzId">Einsatz-ID:</label>
<input type="text" id="einsatzId">
<label for="index">Platz (0-9):</label>
<input type="number" id="index" min="0" max="9">
<button onclick="eintragen()">Eintragen</button>

<h2>Admin Login</h2>
<input type="password" id="adminPasswort" placeholder="Admin-Passwort">
<button onclick="adminLogin()">Login</button>

<div id="adminSection">
    <h2>Neuen Einsatz hinzufügen</h2>
    <input type="text" id="neuName" placeholder="Bezeichnung">
    <input type="text" id="neuDatum" placeholder="Datum">
    <input type="text" id="neuUhrzeit" placeholder="Uhrzeit">
    <input type="text" id="neuVerantwortlich" placeholder="Verantwortlich">
    <input type="text" id="neuKategorie" placeholder="Kategorie">
    <input type="number" id="neuPunkte" placeholder="Punkte">
    <input type="number" id="neuAnzahl" placeholder="Anzahl Helfer">
    <button onclick="einsatzHinzufuegen()">Hinzufügen</button>

    <h3>Sollstunden setzen</h3>
    <input type="number" id="sollPunkte" placeholder="z. B. 10">
    <button onclick="sollPunkteSetzen()">Speichern</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzZ1P23tsbN5zX-BmqG8eNCg0GhxcTdBhxrogBAZYjheiTZGXPuvOo3PhVEx8SVjCAhqQ/exec";
let adminMode = false;

function ladeEinsaetze() {
    fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(obj => {
            const daten = obj.data;
            const tabelle = document.getElementById("einsatzListe");
            tabelle.innerHTML = "<tr><th>ID</th><th>Name</th><th>Datum</th><th>Uhrzeit</th><th>Verantwortlich</th><th>Kategorie</th><th>Punkte</th><th>Benötigte Helfer</th><th>Helfer</th></tr>";
            daten.slice(1).forEach(row => {
                let helfer = row.slice(8, 18).filter(h => h).join(", ");
                tabelle.innerHTML += `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td><td>${row[5]}</td><td>${row[6]}</td><td>${row[7]}</td><td>${helfer}</td></tr>`;
            });
        });
}

function eintragen() {
    const name = document.getElementById("helferName").value;
    const id = document.getElementById("einsatzId").value;
    const index = parseInt(document.getElementById("index").value);

    fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({
            action: "setHelfer",
            name: name,
            id: id,
            index: index
        })
    })
    .then(res => res.json())
    .then(response => {
        alert(response.success ? "Erfolg!" : "Fehler: " + response.message);
        ladeEinsaetze();
    });
}

function adminLogin() {
    const pw = document.getElementById("adminPasswort").value;
    if (pw === "SiebenZwerge") {
        adminMode = true;
        document.getElementById("adminSection").style.display = "block";
    } else {
        alert("Falsches Passwort");
    }
}

function einsatzHinzufuegen() {
    fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({
            action: "addEinsatz",
            adminPassword: "SiebenZwerge",
            name: document.getElementById("neuName").value,
            datum: document.getElementById("neuDatum").value,
            uhrzeit: document.getElementById("neuUhrzeit").value,
            verantwortlich: document.getElementById("neuVerantwortlich").value,
            kategorie: document.getElementById("neuKategorie").value,
            punkte: parseInt(document.getElementById("neuPunkte").value),
            helferanzahl: parseInt(document.getElementById("neuAnzahl").value)
        })
    })
    .then(res => res.json())
    .then(response => {
        alert(response.success ? "Einsatz hinzugefügt" : "Fehler: " + response.message);
        ladeEinsaetze();
    });
}

function sollPunkteSetzen() {
    const sp = parseInt(document.getElementById("sollPunkte").value);
    fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({
            action: "setSollPunkte",
            adminPassword: "SiebenZwerge",
            sollPunkte: sp
        })
    })
    .then(res => res.json())
    .then(response => {
        alert(response.success ? "Gespeichert" : "Fehler: " + response.message);
    });
}

document.addEventListener("DOMContentLoaded", ladeEinsaetze);
</script>
</body>
</html>
